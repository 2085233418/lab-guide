# 第 6 章：进程管理

## 本章概述

> "进程是操作系统的灵魂。"

进程是操作系统资源分配和调度的基本单位。本章将实现完整的进程管理系统，包括 PCB 设计、上下文切换、进程调度、以及 fork/exec/exit/wait 等核心系统调用。

---

## 学习目标

完成本章学习后，你将能够：

- ✅ 理解进程的概念和生命周期
- ✅ 设计进程控制块（PCB）
- ✅ 实现 PID 分配器
- ✅ 实现上下文切换（汇编 + Rust）
- ✅ 编写轮转调度器
- ✅ 实现 fork、exec、exit、wait 系统调用
- ✅ 理解父子进程关系

---

## 内容导览

### 6.1.1 进程概念与 PCB 设计
通过"图书馆借书"的类比，理解进程的本质。设计 PCB 数据结构。

**关键概念：**
- 进程 vs 程序
- PCB（Process Control Block）
- 进程资源管理

### 6.1.2 PID 分配器
实现全局 PID 分配器，为每个进程分配唯一标识符。

**关键概念：**
- PID（Process ID）
- 原子操作
- PID 回收

### 6.1.3 进程状态枚举
定义进程的四种状态：Ready、Running、Blocked、Zombie。

**关键概念：**
- 进程状态机
- 状态转换
- 僵尸进程

### 6.1.4 进程上下文保存
定义 `ProcessContext` 结构体，保存进程的寄存器状态。

**关键概念：**
- 上下文（Context）
- 通用寄存器
- 栈指针

### 6.1.5 PCB 完整实现
完整实现 PCB，包括地址空间、文件描述符表、父子进程关系等。

**关键概念：**
- `Arc<Mutex<PCB>>`
- 地址空间
- 内核栈

### 6.2.1 上下文切换（上）- 机制讲解
详细讲解上下文切换的原理和步骤。

**关键概念：**
- 上下文切换流程
- 保存/恢复现场
- 栈切换

### 6.2.2 上下文切换（下）- 汇编实现
用汇编实现 `switch_to` 函数，完成寄存器的保存和恢复。

**关键概念：**
- `sd`/`ld` 指令
- Callee-saved 寄存器
- `ret` 指令

### 6.3.1 调度器设计
设计全局调度器，管理就绪队列和当前进程。

**关键概念：**
- 就绪队列
- 当前进程
- 调度策略

### 6.3.2 轮转调度实现
实现 Round-Robin 调度算法，公平地分配 CPU 时间片。

**关键概念：**
- 时间片
- FIFO 队列
- 时钟中断

### 6.4.1 进程创建（fork）
实现 `fork` 系统调用，创建子进程，复制父进程的地址空间。

**关键概念：**
- `fork` 语义
- 写时复制（COW）
- 父子进程关系

### 6.4.2 进程执行（exec）
实现 `exec` 系统调用，加载并执行新程序。

**关键概念：**
- `exec` 语义
- ELF 文件加载
- 地址空间替换

### 6.4.3 进程退出（exit）
实现 `exit` 系统调用，释放进程资源，变成僵尸进程。

**关键概念：**
- 退出码
- 资源回收
- 僵尸进程

### 6.4.4 进程等待（wait）
实现 `wait` 系统调用，父进程等待子进程退出，回收僵尸进程。

**关键概念：**
- 阻塞等待
- 退出码获取
- 孤儿进程

---

## 为什么重要？

进程管理是操作系统的核心：

1. **多任务**：让多个程序"同时"运行
2. **隔离**：每个进程有独立的地址空间
3. **资源管理**：公平分配 CPU、内存等资源

---

## 技术亮点

- 🔄 **上下文切换**：汇编与 Rust 的完美配合
- 🎯 **调度算法**：简单而高效的轮转调度
- 👨‍👩‍👧‍👦 **进程家族**：fork/exec/wait 的优雅设计

---

## 预计时间

⏱️ **约 6-8 小时**（本章内容较多）

---

## 开始学习

让我们开始构建进程管理系统！

👉 [6.1.1 进程概念与 PCB 设计](../实验指导书汇总/6.1.1-进程概念与PCB设计.md)
